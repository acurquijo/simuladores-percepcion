<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body{
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:sans-serif;
}

.container{
  display:flex;
  gap:20px;
}

.wrapper{
  width:550px;
  height:340px;
  border-radius:12px;
  overflow:hidden;
  background:#000;
}

canvas{
  width:100%;
  height:100%;
  display:block;
}

.controls{
  color:white;
  width:220px;
}

.controls label{
  display:block;
  margin-top:10px;
  font-size:14px;
}

input{
  width:100%;
}
</style>
</head>
<body>

<div class="container">
  <div class="wrapper">
    <canvas id="glCanvas"></canvas>
  </div>

  <div class="controls">
    <label>Intensidad
      <input type="range" id="amplitude" min="0" max="0.05" step="0.001" value="0.015">
    </label>

    <label>Velocidad
      <input type="range" id="speed" min="0" max="5" step="0.1" value="1">
    </label>

    <label>Dirección
      <input type="range" id="direction" min="0" max="6.28" step="0.1" value="1.57">
    </label>
  </div>
</div>

<script>
const canvas = document.getElementById("glCanvas");
const gl = canvas.getContext("webgl");

canvas.width = 550;
canvas.height = 340;

gl.viewport(0,0,canvas.width,canvas.height);

const vertexShaderSource = `
attribute vec2 a_position;
varying vec2 v_texCoord;

void main(){
  v_texCoord = (a_position + 1.0) * 0.5;
  gl_Position = vec4(a_position,0,1);
}
`;

const fragmentShaderSource = `
precision mediump float;

uniform sampler2D u_image;
uniform float u_time;
uniform float u_amplitude;
uniform float u_speed;
uniform float u_direction;

varying vec2 v_texCoord;

void main(){

  vec2 uv = v_texCoord;

  // ===== ZOOM BASE PARA EVITAR BORDES =====
  float baseZoom = 1.12;
  uv = (uv - 0.5) / baseZoom + 0.5;

  // ===== ONDA ORGÁNICA =====
  vec2 dir = vec2(cos(u_direction), sin(u_direction));
  float wave = sin(dot(uv, dir) * 8.0 + u_time * u_speed) * u_amplitude;

  uv += dir * wave;

  uv = clamp(uv, 0.001, 0.999);

  gl_FragColor = texture2D(u_image, uv);
}
`;

function createShader(type, source){
  const shader = gl.createShader(type);
  gl.shaderSource(shader, source);
  gl.compileShader(shader);
  return shader;
}

const vertexShader = createShader(gl.VERTEX_SHADER, vertexShaderSource);
const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentShaderSource);

const program = gl.createProgram();
gl.attachShader(program, vertexShader);
gl.attachShader(program, fragmentShader);
gl.linkProgram(program);
gl.useProgram(program);

const positionBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
  -1,-1,
   1,-1,
  -1, 1,
  -1, 1,
   1,-1,
   1, 1
]), gl.STATIC_DRAW);

const positionLocation = gl.getAttribLocation(program, "a_position");
gl.enableVertexAttribArray(positionLocation);
gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

const texture = gl.createTexture();
const image = new Image();
image.src = "alex-grey-image1.jpg";

image.onload = function(){
  gl.bindTexture(gl.TEXTURE_2D, texture);
  gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);

  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
};


const timeLocation = gl.getUniformLocation(program, "u_time");
const amplitudeLocation = gl.getUniformLocation(program, "u_amplitude");
const speedLocation = gl.getUniformLocation(program, "u_speed");
const directionLocation = gl.getUniformLocation(program, "u_direction");
const resolutionLocation = gl.getUniformLocation(program, "u_resolution");

gl.uniform2f(resolutionLocation, canvas.width, canvas.height);

let time = 0;

function render(){
  time += 0.016;

  gl.uniform1f(timeLocation, time);
  gl.uniform1f(amplitudeLocation, parseFloat(document.getElementById("amplitude").value));
  gl.uniform1f(speedLocation, parseFloat(document.getElementById("speed").value));
  gl.uniform1f(directionLocation, parseFloat(document.getElementById("direction").value));

  gl.drawArrays(gl.TRIANGLES, 0, 6);
  requestAnimationFrame(render);
}

render();
</script>

</body>
</html>
